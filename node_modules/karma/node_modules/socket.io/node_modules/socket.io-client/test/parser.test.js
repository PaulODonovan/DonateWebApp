
/*!
 * socket.io-node
 * Copyright(c) 2011 LearnBoost <dev@learnboost.com>
 * MIT Licensed
 */

(function (module, io, should) {

  var parser = io.parser;

  module.exports = {

    'decoding error packet': function () {
      parser.decodePacket('7:::').should().eql({
<<<<<<< HEAD
	  type: 'error'
	, reason: ''
	, advice: ''
	, endpoint: ''
=======
          type: 'error'
        , reason: ''
        , advice: ''
        , endpoint: ''
>>>>>>> 40dc066702148240d46d84f6c15203d8e58bc81e
      });
    },

    'decoding error packet with reason': function () {
      parser.decodePacket('7:::0').should().eql({
<<<<<<< HEAD
	  type: 'error'
	, reason: 'transport not supported'
	, advice: ''
	, endpoint: ''
=======
          type: 'error'
        , reason: 'transport not supported'
        , advice: ''
        , endpoint: ''
>>>>>>> 40dc066702148240d46d84f6c15203d8e58bc81e
      });
    },

    'decoding error packet with reason and advice': function () {
      parser.decodePacket('7:::2+0').should().eql({
<<<<<<< HEAD
	  type: 'error'
	, reason: 'unauthorized'
	, advice: 'reconnect'
	, endpoint: ''
=======
          type: 'error'
        , reason: 'unauthorized'
        , advice: 'reconnect'
        , endpoint: ''
>>>>>>> 40dc066702148240d46d84f6c15203d8e58bc81e
      });
    },

    'decoding error packet with endpoint': function () {
      parser.decodePacket('7::/woot').should().eql({
<<<<<<< HEAD
	  type: 'error'
	, reason: ''
	, advice: ''
	, endpoint: '/woot'
=======
          type: 'error'
        , reason: ''
        , advice: ''
        , endpoint: '/woot'
>>>>>>> 40dc066702148240d46d84f6c15203d8e58bc81e
      });
    },

    'decoding ack packet': function () {
      parser.decodePacket('6:::140').should().eql({
<<<<<<< HEAD
	  type: 'ack'
	, ackId: '140'
	, endpoint: ''
	, args: []
=======
          type: 'ack'
        , ackId: '140'
        , endpoint: ''
        , args: []
>>>>>>> 40dc066702148240d46d84f6c15203d8e58bc81e
      });
    },

    'decoding ack packet with args': function () {
      parser.decodePacket('6:::12+["woot","wa"]').should().eql({
<<<<<<< HEAD
	  type: 'ack'
	, ackId: '12'
	, endpoint: ''
	, args: ['woot', 'wa']
=======
          type: 'ack'
        , ackId: '12'
        , endpoint: ''
        , args: ['woot', 'wa']
>>>>>>> 40dc066702148240d46d84f6c15203d8e58bc81e
      });
    },

    'decoding ack packet with bad json': function () {
      var thrown = false;

      try {
<<<<<<< HEAD
	parser.decodePacket('6:::1+{"++]').should().eql({
	    type: 'ack'
	  , ackId: '1'
	  , endpoint: ''
	  , args: []
	});
      } catch (e) {
	thrown = true;
=======
        parser.decodePacket('6:::1+{"++]').should().eql({
            type: 'ack'
          , ackId: '1'
          , endpoint: ''
          , args: []
        });
      } catch (e) {
        thrown = true;
>>>>>>> 40dc066702148240d46d84f6c15203d8e58bc81e
      }

      thrown.should().be_false;
    },

    'decoding json packet': function () {
      parser.decodePacket('4:::"2"').should().eql({
<<<<<<< HEAD
	  type: 'json'
	, endpoint: ''
	, data: '2'
=======
          type: 'json'
        , endpoint: ''
        , data: '2'
>>>>>>> 40dc066702148240d46d84f6c15203d8e58bc81e
      });
    },

    'decoding json packet with message id and ack data': function () {
      parser.decodePacket('4:1+::{"a":"b"}').should().eql({
<<<<<<< HEAD
	  type: 'json'
	, id: 1
	, ack: 'data'
	, endpoint: ''
	, data: { a: 'b' }
=======
          type: 'json'
        , id: 1
        , ack: 'data'
        , endpoint: ''
        , data: { a: 'b' }
>>>>>>> 40dc066702148240d46d84f6c15203d8e58bc81e
      });
    },

    'decoding an event packet': function () {
      parser.decodePacket('5:::{"name":"woot"}').should().eql({
<<<<<<< HEAD
	  type: 'event'
	, name: 'woot'
	, endpoint: ''
	, args: []
=======
          type: 'event'
        , name: 'woot'
        , endpoint: ''
        , args: []
>>>>>>> 40dc066702148240d46d84f6c15203d8e58bc81e
      });
    },

    'decoding an event packet with message id and ack': function () {
      parser.decodePacket('5:1+::{"name":"tobi"}').should().eql({
<<<<<<< HEAD
	  type: 'event'
	, id: 1
	, ack: 'data'
	, endpoint: ''
	, name: 'tobi'
	, args: []
=======
          type: 'event'
        , id: 1
        , ack: 'data'
        , endpoint: ''
        , name: 'tobi'
        , args: []
>>>>>>> 40dc066702148240d46d84f6c15203d8e58bc81e
      });
    },

    'decoding an event packet with data': function () {
      parser.decodePacket('5:::{"name":"edwald","args":[{"a": "b"},2,"3"]}')
      .should().eql({
<<<<<<< HEAD
	  type: 'event'
	, name: 'edwald'
	, endpoint: ''
	, args: [{a: 'b'}, 2, '3']
=======
          type: 'event'
        , name: 'edwald'
        , endpoint: ''
        , args: [{a: 'b'}, 2, '3']
>>>>>>> 40dc066702148240d46d84f6c15203d8e58bc81e
      });
    },

    'decoding a message packet': function () {
      parser.decodePacket('3:::woot').should().eql({
<<<<<<< HEAD
	  type: 'message'
	, endpoint: ''
	, data: 'woot'
=======
          type: 'message'
        , endpoint: ''
        , data: 'woot'
>>>>>>> 40dc066702148240d46d84f6c15203d8e58bc81e
      });
    },

    'decoding a message packet with id and endpoint': function () {
      parser.decodePacket('3:5:/tobi').should().eql({
<<<<<<< HEAD
	  type: 'message'
	, id: 5
	, ack: true
	, endpoint: '/tobi'
	, data: ''
=======
          type: 'message'
        , id: 5
        , ack: true
        , endpoint: '/tobi'
        , data: ''
>>>>>>> 40dc066702148240d46d84f6c15203d8e58bc81e
      });
    },

    'decoding a heartbeat packet': function () {
      parser.decodePacket('2:::').should().eql({
<<<<<<< HEAD
	  type: 'heartbeat'
	, endpoint: ''
=======
          type: 'heartbeat'
        , endpoint: ''
>>>>>>> 40dc066702148240d46d84f6c15203d8e58bc81e
      });
    },

    'decoding a connection packet': function () {
      parser.decodePacket('1::/tobi').should().eql({
<<<<<<< HEAD
	  type: 'connect'
	, endpoint: '/tobi'
	, qs: ''
=======
          type: 'connect'
        , endpoint: '/tobi'
        , qs: ''
>>>>>>> 40dc066702148240d46d84f6c15203d8e58bc81e
      });
    },

    'decoding a connection packet with query string': function () {
      parser.decodePacket('1::/test:?test=1').should().eql({
<<<<<<< HEAD
	  type: 'connect'
	, endpoint: '/test'
	, qs: '?test=1'
=======
          type: 'connect'
        , endpoint: '/test'
        , qs: '?test=1'
>>>>>>> 40dc066702148240d46d84f6c15203d8e58bc81e
      });
    },

    'decoding a disconnection packet': function () {
      parser.decodePacket('0::/woot').should().eql({
<<<<<<< HEAD
	  type: 'disconnect'
	, endpoint: '/woot'
=======
          type: 'disconnect'
        , endpoint: '/woot'
>>>>>>> 40dc066702148240d46d84f6c15203d8e58bc81e
      });
    },

    'encoding error packet': function () {
      parser.encodePacket({
<<<<<<< HEAD
	  type: 'error'
	, reason: ''
	, advice: ''
	, endpoint: ''
=======
          type: 'error'
        , reason: ''
        , advice: ''
        , endpoint: ''
>>>>>>> 40dc066702148240d46d84f6c15203d8e58bc81e
      }).should().eql('7::');
    },

    'encoding error packet with reason': function () {
      parser.encodePacket({
<<<<<<< HEAD
	  type: 'error'
	, reason: 'transport not supported'
	, advice: ''
	, endpoint: ''
=======
          type: 'error'
        , reason: 'transport not supported'
        , advice: ''
        , endpoint: ''
>>>>>>> 40dc066702148240d46d84f6c15203d8e58bc81e
      }).should().eql('7:::0');
    },

    'encoding error packet with reason and advice': function () {
      parser.encodePacket({
<<<<<<< HEAD
	  type: 'error'
	, reason: 'unauthorized'
	, advice: 'reconnect'
	, endpoint: ''
=======
          type: 'error'
        , reason: 'unauthorized'
        , advice: 'reconnect'
        , endpoint: ''
>>>>>>> 40dc066702148240d46d84f6c15203d8e58bc81e
      }).should().eql('7:::2+0');
    },

    'encoding error packet with endpoint': function () {
      parser.encodePacket({
<<<<<<< HEAD
	  type: 'error'
	, reason: ''
	, advice: ''
	, endpoint: '/woot'
=======
          type: 'error'
        , reason: ''
        , advice: ''
        , endpoint: '/woot'
>>>>>>> 40dc066702148240d46d84f6c15203d8e58bc81e
      }).should().eql('7::/woot');
    },

    'encoding ack packet': function () {
      parser.encodePacket({
<<<<<<< HEAD
	  type: 'ack'
	, ackId: '140'
	, endpoint: ''
	, args: []
=======
          type: 'ack'
        , ackId: '140'
        , endpoint: ''
        , args: []
>>>>>>> 40dc066702148240d46d84f6c15203d8e58bc81e
      }).should().eql('6:::140');
    },

    'encoding ack packet with args': function () {
      parser.encodePacket({
<<<<<<< HEAD
	  type: 'ack'
	, ackId: '12'
	, endpoint: ''
	, args: ['woot', 'wa']
=======
          type: 'ack'
        , ackId: '12'
        , endpoint: ''
        , args: ['woot', 'wa']
>>>>>>> 40dc066702148240d46d84f6c15203d8e58bc81e
      }).should().eql('6:::12+["woot","wa"]');
    },

    'encoding json packet': function () {
      parser.encodePacket({
<<<<<<< HEAD
	  type: 'json'
	, endpoint: ''
	, data: '2'
=======
          type: 'json'
        , endpoint: ''
        , data: '2'
>>>>>>> 40dc066702148240d46d84f6c15203d8e58bc81e
      }).should().eql('4:::"2"');
    },

    'encoding json packet with message id and ack data': function () {
      parser.encodePacket({
<<<<<<< HEAD
	  type: 'json'
	, id: 1
	, ack: 'data'
	, endpoint: ''
	, data: { a: 'b' }
=======
          type: 'json'
        , id: 1
        , ack: 'data'
        , endpoint: ''
        , data: { a: 'b' }
>>>>>>> 40dc066702148240d46d84f6c15203d8e58bc81e
      }).should().eql('4:1+::{"a":"b"}');
    },

    'encoding an event packet': function () {
      parser.encodePacket({
<<<<<<< HEAD
	  type: 'event'
	, name: 'woot'
	, endpoint: ''
	, args: []
=======
          type: 'event'
        , name: 'woot'
        , endpoint: ''
        , args: []
>>>>>>> 40dc066702148240d46d84f6c15203d8e58bc81e
      }).should().eql('5:::{"name":"woot"}');
    },

    'encoding an event packet with message id and ack': function () {
      parser.encodePacket({
<<<<<<< HEAD
	  type: 'event'
	, id: 1
	, ack: 'data'
	, endpoint: ''
	, name: 'tobi'
	, args: []
=======
          type: 'event'
        , id: 1
        , ack: 'data'
        , endpoint: ''
        , name: 'tobi'
        , args: []
>>>>>>> 40dc066702148240d46d84f6c15203d8e58bc81e
      }).should().eql('5:1+::{"name":"tobi"}');
    },

    'encoding an event packet with data': function () {
      parser.encodePacket({
<<<<<<< HEAD
	  type: 'event'
	, name: 'edwald'
	, endpoint: ''
	, args: [{a: 'b'}, 2, '3']
=======
          type: 'event'
        , name: 'edwald'
        , endpoint: ''
        , args: [{a: 'b'}, 2, '3']
>>>>>>> 40dc066702148240d46d84f6c15203d8e58bc81e
      }).should().eql('5:::{"name":"edwald","args":[{"a":"b"},2,"3"]}');
    },

    'encoding a message packet': function () {
      parser.encodePacket({
<<<<<<< HEAD
	  type: 'message'
	, endpoint: ''
	, data: 'woot'
=======
          type: 'message'
        , endpoint: ''
        , data: 'woot'
>>>>>>> 40dc066702148240d46d84f6c15203d8e58bc81e
      }).should().eql('3:::woot');
    },

    'encoding a message packet with id and endpoint': function () {
      parser.encodePacket({
<<<<<<< HEAD
	  type: 'message'
	, id: 5
	, ack: true
	, endpoint: '/tobi'
	, data: ''
=======
          type: 'message'
        , id: 5
        , ack: true
        , endpoint: '/tobi'
        , data: ''
>>>>>>> 40dc066702148240d46d84f6c15203d8e58bc81e
      }).should().eql('3:5:/tobi');
    },

    'encoding a heartbeat packet': function () {
      parser.encodePacket({
<<<<<<< HEAD
	  type: 'heartbeat'
	, endpoint: ''
=======
          type: 'heartbeat'
        , endpoint: ''
>>>>>>> 40dc066702148240d46d84f6c15203d8e58bc81e
      }).should().eql('2::');
    },

    'encoding a connection packet': function () {
      parser.encodePacket({
<<<<<<< HEAD
	  type: 'connect'
	, endpoint: '/tobi'
	, qs: ''
=======
          type: 'connect'
        , endpoint: '/tobi'
        , qs: ''
>>>>>>> 40dc066702148240d46d84f6c15203d8e58bc81e
      }).should().eql('1::/tobi');
    },

    'encoding a connection packet with query string': function () {
      parser.encodePacket({
<<<<<<< HEAD
	  type: 'connect'
	, endpoint: '/test'
	, qs: '?test=1'
=======
          type: 'connect'
        , endpoint: '/test'
        , qs: '?test=1'
>>>>>>> 40dc066702148240d46d84f6c15203d8e58bc81e
      }).should().eql('1::/test:?test=1');
    },

    'encoding a disconnection packet': function () {
      parser.encodePacket({
<<<<<<< HEAD
	  type: 'disconnect'
	, endpoint: '/woot'
=======
          type: 'disconnect'
        , endpoint: '/woot'
>>>>>>> 40dc066702148240d46d84f6c15203d8e58bc81e
      }).should().eql('0::/woot');
    },

    'test decoding a payload': function () {
      parser.decodePayload('\ufffd5\ufffd3:::5\ufffd7\ufffd3:::53d'
<<<<<<< HEAD
	+ '\ufffd3\ufffd0::').should().eql([
	  { type: 'message', data: '5', endpoint: '' }
	, { type: 'message', data: '53d', endpoint: '' }
	, { type: 'disconnect', endpoint: '' }
=======
        + '\ufffd3\ufffd0::').should().eql([
          { type: 'message', data: '5', endpoint: '' }
        , { type: 'message', data: '53d', endpoint: '' }
        , { type: 'disconnect', endpoint: '' }
>>>>>>> 40dc066702148240d46d84f6c15203d8e58bc81e
      ]);
    },

    'test encoding a payload': function () {
      parser.encodePayload([
<<<<<<< HEAD
	  parser.encodePacket({ type: 'message', data: '5', endpoint: '' })
	, parser.encodePacket({ type: 'message', data: '53d', endpoint: '' })
=======
          parser.encodePacket({ type: 'message', data: '5', endpoint: '' })
        , parser.encodePacket({ type: 'message', data: '53d', endpoint: '' })
>>>>>>> 40dc066702148240d46d84f6c15203d8e58bc81e
      ]).should().eql('\ufffd5\ufffd3:::5\ufffd7\ufffd3:::53d')
    },

    'test decoding newline': function () {
      parser.decodePacket('3:::\n').should().eql({
<<<<<<< HEAD
	  type: 'message'
	, endpoint: ''
	, data: '\n'
=======
          type: 'message'
        , endpoint: ''
        , data: '\n'
>>>>>>> 40dc066702148240d46d84f6c15203d8e58bc81e
      });
    }

  };

})(
    'undefined' == typeof module ? module = {} : module
  , 'undefined' == typeof io ? require('socket.io-client') : io
  , 'undefined' == typeof should ? require('should') : should
);
