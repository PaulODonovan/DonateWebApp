var redis = require("../index"),
    client = redis.createClient(null, null, {
<<<<<<< HEAD
	command_queue_high_water: 5,
	command_queue_low_water: 1
=======
        command_queue_high_water: 5,
        command_queue_low_water: 1
>>>>>>> 40dc066702148240d46d84f6c15203d8e58bc81e
    }),
    remaining_ops = 100000, paused = false;

function op() {
    if (remaining_ops <= 0) {
<<<<<<< HEAD
	console.error("Finished.");
	process.exit(0);
=======
        console.error("Finished.");
        process.exit(0);
>>>>>>> 40dc066702148240d46d84f6c15203d8e58bc81e
    }

    remaining_ops--;
    if (client.hset("test hash", "val " + remaining_ops, remaining_ops) === false) {
<<<<<<< HEAD
	console.log("Pausing at " + remaining_ops);
	paused = true;
    } else {
	process.nextTick(op);
=======
        console.log("Pausing at " + remaining_ops);
        paused = true;
    } else {
        process.nextTick(op);
>>>>>>> 40dc066702148240d46d84f6c15203d8e58bc81e
    }
}

client.on("drain", function () {
    if (paused) {
<<<<<<< HEAD
	console.log("Resuming at " + remaining_ops);
	paused = false;
	process.nextTick(op);
    } else {
	console.log("Got drain while not paused at " + remaining_ops);
=======
        console.log("Resuming at " + remaining_ops);
        paused = false;
        process.nextTick(op);
    } else {
        console.log("Got drain while not paused at " + remaining_ops);
>>>>>>> 40dc066702148240d46d84f6c15203d8e58bc81e
    }
});

op();
