var test = require('tap').test;
var resolve = require('../');

test('mock', function (t) {
    t.plan(4);
<<<<<<< HEAD

    var files = {
	'/foo/bar/baz.js' : 'beep'
    };

    function opts (basedir) {
	return {
	    basedir : basedir,
	    isFile : function (file, cb) {
		cb(null, files.hasOwnProperty(file));
	    },
	    readFile : function (file, cb) {
		cb(null, files[file]);
	    }
	}
    }

    resolve('./baz', opts('/foo/bar'), function (err, res) {
	if (err) t.fail(err);
	t.equal(res, '/foo/bar/baz.js');
    });

    resolve('./baz.js', opts('/foo/bar'), function (err, res) {
	if (err) t.fail(err);
	t.equal(res, '/foo/bar/baz.js');
    });

    resolve('baz', opts('/foo/bar'), function (err, res) {
	t.equal(err.message, "Cannot find module 'baz'");
    });

    resolve('../baz', opts('/foo/bar'), function (err, res) {
	t.equal(err.message, "Cannot find module '../baz'");
=======
    
    var files = {
        '/foo/bar/baz.js' : 'beep'
    };
    
    function opts (basedir) {
        return {
            basedir : basedir,
            isFile : function (file, cb) {
                cb(null, files.hasOwnProperty(file));
            },
            readFile : function (file, cb) {
                cb(null, files[file]);
            }
        }
    }
    
    resolve('./baz', opts('/foo/bar'), function (err, res) {
        if (err) t.fail(err);
        t.equal(res, '/foo/bar/baz.js');
    });
    
    resolve('./baz.js', opts('/foo/bar'), function (err, res) {
        if (err) t.fail(err);
        t.equal(res, '/foo/bar/baz.js');
    });
    
    resolve('baz', opts('/foo/bar'), function (err, res) {
        t.equal(err.message, "Cannot find module 'baz'");
    });
    
    resolve('../baz', opts('/foo/bar'), function (err, res) {
        t.equal(err.message, "Cannot find module '../baz'");
>>>>>>> 40dc066702148240d46d84f6c15203d8e58bc81e
    });
});

test('mock package', function (t) {
    t.plan(1);
<<<<<<< HEAD

    var files = {
	'/foo/node_modules/bar/baz.js' : 'beep',
	'/foo/node_modules/bar/package.json' : JSON.stringify({
	    main : './baz.js'
	})
    };

    function opts (basedir) {
	return {
	    basedir : basedir,
	    isFile : function (file, cb) {
		cb(null, files.hasOwnProperty(file));
	    },
	    readFile : function (file, cb) {
		cb(null, files[file]);
	    }
	}
    }

    resolve('bar', opts('/foo'), function (err, res) {
	if (err) t.fail(err);
	t.equal(res, '/foo/node_modules/bar/baz.js');
=======
    
    var files = {
        '/foo/node_modules/bar/baz.js' : 'beep',
        '/foo/node_modules/bar/package.json' : JSON.stringify({
            main : './baz.js'
        })
    };
    
    function opts (basedir) {
        return {
            basedir : basedir,
            isFile : function (file, cb) {
                cb(null, files.hasOwnProperty(file));
            },
            readFile : function (file, cb) {
                cb(null, files[file]);
            }
        }
    }
    
    resolve('bar', opts('/foo'), function (err, res) {
        if (err) t.fail(err);
        t.equal(res, '/foo/node_modules/bar/baz.js');
>>>>>>> 40dc066702148240d46d84f6c15203d8e58bc81e
    });
});
